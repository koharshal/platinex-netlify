---
import BaseLayout from '../../layouts/BaseLayout.astro'
import ListPosts from '../../components/ListPosts.astro'
import ListCategories from '../../components/ListCategories.astro'
import Pagination from '../../components/Pagination.astro'
import TitlePage from '../../components/TitlePage.astro'
import { getPosts } from '../../utils/index.ts'
import { siteConfig } from '../../data/site.config'

const MAX_POSTS = 5
const viewAll = Astro.url.searchParams.get('view') === 'all'
const posts = viewAll ? await getPosts() : await getPosts(MAX_POSTS)
---

<BaseLayout title='Blog'>
	<div class='mx-auto w-full max-w-6xl px-4 sm:px-6 lg:px-8'>
		<section class='grid gap-6 md:gap-8'>
			<!-- Hero Section -->
			<div
				class='relative rounded-3xl overflow-hidden ring-1 ring-stone-200/70 dark:ring-white/10 bg-gradient-to-br from-stone-50 to-stone-100 dark:from-stone-900/50 dark:to-stone-800/50'
			>
				<div class='relative z-10 px-6 py-8 md:px-12 md:py-12'>
					<h1 class='text-4xl md:text-6xl font-extrabold leading-tight tracking-tight text-center'>
						<span class='accent-underline'>Platinex</span> Blog
					</h1>
					<p
						class='mt-3 md:mt-4 text-lg md:text-xl text-stone-700 dark:text-stone-300 max-w-3xl mx-auto text-center'
					>
						Insights, updates, and knowledge sharing from the world of electroplating and metal
						finishing.
					</p>
				</div>
			</div>

			{/* Show title for "View All" */}
			{
				viewAll && (
					<section class='text-center'>
						<h2 class='text-2xl md:text-3xl font-bold tracking-tight'>All Blog Posts</h2>
					</section>
				)
			}

			{/* Categories Section - only show when not viewing all */}
			{
				!viewAll && (
					<section class='grid gap-6'>
						<h2 class='text-2xl md:text-3xl font-bold tracking-tight text-center'>
							Browse by Category
						</h2>
						<div class='bg-white/70 dark:bg-white/5 rounded-2xl border border-stone-200 dark:border-white/10 p-6'>
							<ListCategories />
						</div>
					</section>
				)
			}

			{/* Posts Section */}
			<section class='grid gap-6'>
				{
					!viewAll && (
						<h2 class='text-2xl md:text-3xl font-bold tracking-tight text-center'>Latest Posts</h2>
					)
				}
				<div
					class='bg-white/70 dark:bg-white/5 rounded-2xl border border-stone-200 dark:border-white/10 p-6'
				>
					<ListPosts FirstBig={!viewAll} posts={posts} />
				</div>
			</section>
		</section>
	</div>
</BaseLayout>

<script>
	import { animate } from 'motion'
	const showAnimations = localStorage.getItem('animations') === 'true'

	if (showAnimations) {
		animate(
			'.title',
			{ y: [80, 0], opacity: [0, 1] },
			{
				duration: 2.5,
				opacity: { duration: 3 },
				offset: [0, 0.55, 0.75]
			}
		)
	}
</script>
